# Demo
# Written by: Kristina Miller
import numpy as np
import pypoman as ppm
import matplotlib.pyplot as plt
import polytope as pc

def problem():
    # TODO: Create more obstacles
    obs = [[[6,6],[6,36],[36,36],[36,6]],
        [[6,42],[6,72],[36,72],[36,42]],
        [[42,6],[72,6],[72,36],[42,36]],
        [[42,42],[72,42],[72,72],[42,72]],
        [[6,78],[36,78],[36,108],[6,108]],
        [[42,78],[72,78],[72,108],[42,108]],
        [[78,6],[144,6],[144,108],[78,108]],
        [[150,6],[216,6],[216,108],[150,108]],
        [[150,78],[216,78],[252,108],[150,108]],
        [[258,0],[300,0],[300,314],[258,314]],
        [[6,114],[36,114],[36,144],[6,144]],
        [[6,150],[36,150],[36,180],[6,180]],
        [[42,114],[72,114],[72,144],[42,144]],
        [[42,150],[72,150],[72,180],[42,180]],
        [[72+6,114],[72+36,114],[72+36,144],[72+6,144]],
        [[72+6,150],[72+36,150],[72+36,180],[72+6,180]],
        [[72+42,114],[72+72,114],[72+72,144],[72+42,144]],
        [[72+42,150],[72+72,150],[72+72,180],[72+42,180]],
        [[222,0],[258,0],[258,102],[222,72]],
        [[114,186],[144,186],[144,4818/23],[114,216]],
        [[78,186],[108,186],[108,216],[78,216]],
        [[42,186],[72,186],[72,216]],
        [[6,186],[36,186],[18,216],[6,216]],
        [[6,216],[18,216],[36,236],[6,236]],
        [[6,242],[36,242],[36,272],[6,272]],
        [[6,278],[36,278],[36,308],[6,308]],
        [[42,242],[42,272],[72,272]],
        [[72,260],[72,222],[42,192],[27,216]],
        [[42,278],[42,308],[72,308],[72,278]],
        [[78,222],[114,308],[78,308],[114,222]],
        [[120,266],[144,266],[144,308],[120,308]],
        [[114,222],[144,4818/23+6],[114,260],[144,260]],
        [[150,266],[168,308],[150,308],[168,266]],
        [[174,266],[192,308],[174,308],[192,266]],
        [[198,266],[216,308],[198,308],[216,266]],
        [[198,260],[216,242],[198,242],[216,260]],
        [[150,4788/23+6],[252,192],[252,236],[150,236]],
        [[150,236],[192,236],[192,260],[150,260]],
        [[224,236],[252,236],[252,308],[224,308]],
        [[150,180],[252,180],[252,186],[150,4788/23]],
        [[150,150],[168,150],[168,180],[150,180]],
        [[222,114],[252,114],[252,138],[222,138]],
        [[150,114],[168,114],[168,144],[150,144]],
        [[234,138],[252,138],[252,180],[234,180]],
        [[168,114],[216,114],[216,138],[168,138]],
        [[174,144],[198,144],[198,174],[174,174]],
        [[204,144],[228,144],[228,174],[204,174]]
        ]

    obstacles = []

    for i in range(len(obs)):
        poly = pc.qhull(np.array(obs[i]))
        A = poly.A
        b = poly.b
        obstacles.append((A,b))
         
    A_rect = np.array([[-1,0],
                       [1,0],
                       [0,-1],
                       [0,1]])    
    b0 = np.array([[-2], [4], [-2], [4]])
    Theta = (A_rect, b0)

    # #TODO: Create goal set
    bg = [
        [[-198], [204], [-156], [162]],
        [[-252],[258],[-308],[314]],
        [[-36],[42],[-236],[242]],
        [[-252],[258],[-102],[108]],
        [[-72],[78],[-272],[278]],
        [[-144],[150],[-260],[266]],
        [[0],[6],[-308],[314]]
    ]
    goal = []
    for i in range(len(bg)):
        goal.append((A_rect,np.array(bg[i])))
    return obstacles , Theta, goal

if __name__ == '__main__':
    obs, Theta, goal = problem()

    for A,b in obs:
        ppm.polygon.plot_polygon(ppm.duality.compute_polytope_vertices(A,b), color = 'red')

    for A,b in goal:
        ppm.polygon.plot_polygon(ppm.duality.compute_polytope_vertices(A,b), color = 'green')

    ppm.polygon.plot_polygon(ppm.duality.compute_polytope_vertices(Theta[0],Theta[1]), color = 'blue')
    plt.xlim(0, 300)
    plt.ylim(0, 314)
    plt.grid()
    plt.show()
